!function(e,t,r,a,n,o,s,p,g,l,b){null!==TribeEventsPro.geocenter.max_lat&&(r.extend(tribe_ev.fn,{map_add_marker:function(e,t,r,a,i){var n=new google.maps.LatLng(e,t),o={position:n,map:s.map};"undefined"!==GeoLoc.pin_url&&GeoLoc.pin_url&&(o.icon=GeoLoc.pin_url),o=new google.maps.Marker(o);var p=new google.maps.InfoWindow,g=r;a&&(g=g+"<br/>Address: "+a),p.setContent(g),google.maps.event.addListener(o,"click",function(e){p.open(s.map,o)}),s.markers.push(o),s.refine&&o.setVisible(!1),s.bounds.extend(n)}}),s.geocoder=new google.maps.Geocoder,s.bounds=new google.maps.LatLngBounds,r(t).ready(function(){function _(){if(r("#tribe-bar-geoloc").length){var e=r("#tribe-bar-geoloc").val(),t=r("#tribe_events_filter_item_geofence"),a=r("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng");e.length?t.show():(t.hide(),a.length&&a.val(""))}}function d(){if(p.ajax_running=!0,p.params={action:"tribe_geosearch",tribe_paged:p.paged,tribe_event_display:p.view,featured:o.is_featured()},p.category&&(p.params.tribe_event_category=p.category),a.default_permalinks&&(p.params.hasOwnProperty("post_type")||(p.params.post_type=l.events_post_type),p.params.hasOwnProperty("eventDisplay")||(p.params.eventDisplay="map")),r(n).trigger("tribe_ev_serializeBar"),r(n).trigger("serialize-bar.tribe"),o.invalid_date_in_params(p.params))return p.ajax_running=!1,void(y=!0);y=!1,p.params=r.param(p.params),r(n).trigger("tribe_ev_collectParams"),r(n).trigger("collect-params.tribe")}function c(){p.popping||(d(),p.pushstate=!1,p.initial_load||(p.do_string=!0)),y||(r("#tribe-events-content .tribe-events-loop").tribe_spin(),m(),r.post(GeoLoc.ajaxurl,p.params,function(e){if(r(n).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_mapView_AjaxStart"),r(n).trigger("ajax-start.tribe").trigger("map-view-ajax-start.tribe"),o.enable_inputs("#tribe_events_filters_form","input, select"),e.success){p.ajax_running=!1,a.ajax_response={total_count:parseInt(e.total_count),view:e.view,max_pages:e.max_pages,tribe_paged:e.tribe_paged,timestamp:(new Date).getTime()},p.initial_load=!1;var i=r.parseHTML(e.html);r("#tribe-events-content").replaceWith(i),0==e.total_count&&r("#tribe-events-header").hide();var s=function(e){for(var t=[],r=0;r<e.length;r++){var a=!1,i=e[r];if(t.forEach(function(e){i.lat==e.lat&&i.lng==e.lng&&i.title!=e.title&&(a=!0,e.title="<center>"+e.title+i.title.link(i.link)+"<center>")}),!a){var n="";n="<center>"+n+i.title.link(i.link)+"</center>",t.push({lat:i.lat,lng:i.lng,title:n,address:i.address})}}return t}(e.markers);if(r.each(s,function(e,t){o.map_add_marker(t.lat,t.lng,t.title,t.address)}),g.pushstate){if(p.page_title=r("#tribe-events-header").data("title"),t.title=p.page_title,p.do_string){var l=p.params.replace(/&?baseurl=[^&]*/i,"");history.pushState({tribe_paged:p.paged,tribe_params:p.params},p.page_title,a.cur_url+"?"+l)}p.pushstate&&history.pushState({tribe_paged:p.paged,tribe_params:p.params},p.page_title,a.cur_url)}r(n).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_mapView_AjaxSuccess"),r(n).trigger("ajax-success.tribe").trigger("map-view-ajax-success.tribe"),e.markers.length>0&&u()}}))}function v(e){if("change_view"!=tribe_events_bar_action){if(e.preventDefault(),p.ajax_running)return;p.paged=1,p.view="map",p.popping=!1,g.pushstate?o.pre_ajax(function(){c(null)}):o.pre_ajax(function(){r(n).trigger("tribe_ev_reloadOldBrowser"),r(n).trigger("reload-old-browser.tribe")})}}function m(){if(s.markers){for(i in s.markers)s.markers[i].setMap(null);s.markers.length=0,s.bounds=new google.maps.LatLngBounds}}function u(){s.map.fitBounds(s.bounds),s.map.getZoom()>13&&s.map.setZoom(13)}function f(){r("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").show()}function w(){r("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").hide()}_();var h=r("#tribe-events"),x=r("#tribe-bar-geoloc"),j=r("#tribe-geo-options"),y=!1,k={zoom:5,center:new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng),mapTypeId:google.maps.MapTypeId.ROADMAP};if(t.getElementById("tribe-geo-map")){s.map=new google.maps.Map(t.getElementById("tribe-geo-map"),k),s.bounds=new google.maps.LatLngBounds;var L=new google.maps.LatLng(TribeEventsPro.geocenter.min_lat,TribeEventsPro.geocenter.min_lng);s.bounds.extend(L);var T=new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng);s.bounds.extend(T)}if(r().placeholder&&r("#tribe-geo-location").placeholder(),g.map_view()){var B=o.get_url_param("tribe_paged"),E=o.get_url_param("tribe_event_display");B&&(p.paged=B),p.view="map","past"==E&&(p.view="past"),o.tooltips()}if(g.map_view()&&a.params){var P=a.params;o.in_params(P,"tribe_geosearch")>=0||(P+="&action=tribe_geosearch"),o.in_params(P,"tribe_paged")>=0||(P+="&tribe_paged=1"),p.params=P,p.do_string=!1,p.pushstate=!1,p.popping=!0,o.pre_ajax(function(){c()})}else g.map_view()&&(p.do_string=!1,p.pushstate=!1,p.popping=!1,p.initial_load=!0,o.pre_ajax(function(){c()}));if(g.pushstate&&g.map_view()&&(history.replaceState({tribe_paged:p.paged,tribe_params:p.params},"",location.href),r(e).on("popstate",function(e){var t=e.originalEvent.state;t&&(p.do_string=!1,p.pushstate=!1,p.popping=!0,p.params=t.tribe_params,p.paged=t.tribe_paged,o.pre_ajax(function(){c()}),o.set_form(p.params))})),g.map_view()&&(h.on("click",".tribe-geo-option-link",function(e){e.preventDefault(),e.stopPropagation();var t=r(this);r(".tribe-geo-option-link").removeClass("tribe-option-loaded"),t.addClass("tribe-option-loaded"),x.val(t.text()),r("#tribe-bar-geoloc-lat").val(s.geocodes[t.data("index")].geometry.location.lat()),r("#tribe-bar-geoloc-lng").val(s.geocodes[t.data("index")].geometry.location.lng()),p.do_string=!0,p.pushstate=!1,p.popping=!1,g.pushstate?o.pre_ajax(function(){c(),j.hide()}):o.pre_ajax(function(){r(n).trigger("tribe_ev_reloadOldBrowser"),r(n).trigger("reload-old-browser.tribe")})}),r(t).on("click",function(){j.hide()}),o.snap("#tribe-events-content-wrapper","#tribe-events-content-wrapper","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a")),r(n).on("reload-old-browser.tribe",function(){d(),e.location=a.cur_url+"?"+p.params}),g.map_view()){var D;r("#tribe-geo-map-wrapper").resize(function(){D=s.map.getCenter(),google.maps.event.trigger(s.map,"resize"),s.map.setCenter(D)}),r("#tribe-events").on("click","li.tribe-events-nav-next a",function(e){e.preventDefault(),p.ajax_running||("past"===p.view?"1"==p.paged?p.view="map":p.paged--:p.paged++,p.popping=!1,g.pushstate?o.pre_ajax(function(){c()}):o.pre_ajax(function(){r(n).trigger("tribe_ev_reloadOldBrowser"),r(n).trigger("reload-old-browser.tribe")}))}).on("click","li.tribe-events-nav-previous a",function(e){e.preventDefault(),p.ajax_running||("map"===p.view?"1"==p.paged?p.view="past":p.paged--:p.paged++,p.popping=!1,g.pushstate?o.pre_ajax(function(){c(null)}):o.pre_ajax(function(){r(n).trigger("tribe_ev_reloadOldBrowser"),r(n).trigger("reload-old-browser.tribe")}))})}(GeoLoc.map_view&&r("form#tribe-bar-form").length&&g.live_ajax()&&g.pushstate||GeoLoc.map_view&&g.no_bar())&&r("#tribe-events-bar").on("changeDate","#tribe-bar-date",function(e){v(e)}),GeoLoc.map_view&&r(n).on("run-ajax.tribe",function(){c()}),g.map_view()&&(r("form#tribe-bar-form").on("submit",function(){if("change_view"!=tribe_events_bar_action){p.paged=1,f(),r(".tribe-events-sub-nav").remove();var e=r("#tribe-bar-geoloc").val();return""!==e?(p.do_string=!0,p.pushstate=!1,p.popping=!1,m(),r("#tribe-geo-results").empty(),r("#tribe-geo-options").hide(),r("#tribe-geo-options #tribe-geo-links").empty(),o.process_geocoding(e,function(e){s.geocodes=e,w();var t=e[0].geometry.location.lat(),a=e[0].geometry.location.lng();t&&r("#tribe-bar-geoloc-lat").val(t),a&&r("#tribe-bar-geoloc-lng").val(a),s.geocodes.length>1?(o.print_geo_options(),_(),u()):g.pushstate?(_(),c(s.geocodes[0])):(r(n).trigger("tribe_ev_reloadOldBrowser"),r(n).trigger("reload-old-browser.tribe"))}),!1):""!==e||(r("#tribe-bar-geoloc-lat").val(""),r("#tribe-bar-geoloc-lng").val(""),r("#tribe-geo-options").hide(),g.pushstate?(p.do_string=!0,p.pushstate=!1,p.popping=!1,_(),c()):(r(n).trigger("tribe_ev_reloadOldBrowser"),r(n).trigger("reload-old-browser.tribe")),w(),!1)}}),p.view&&b&&debug.timeEnd("Tribe JS Init Timer")),b&&debug.info("TEC Debug: tribe-events-ajax-maps.js successfully loaded")}))}(window,document,jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.geoloc,tribe_ev.state,tribe_ev.tests,tribe_js_config,tribe_debug);
